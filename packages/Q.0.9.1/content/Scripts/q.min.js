(function(e){if(typeof bootstrap==="function"){bootstrap("promise",e)}else if(typeof exports==="object"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=e}}else{Q=e()}})(function(){"use strict";function i(e){var t=Function.call;return function(){return t.apply(e,arguments)}}function p(e){return h(e)==="[object StopIteration]"||e instanceof d}function m(e,t){if(t.stack&&typeof e==="object"&&e!==null&&e.stack&&e.stack.indexOf(v)===-1){e.stack=g(e.stack)+"\n"+v+"\n"+g(t.stack)}}function g(e){var t=e.split("\n");var n=[];for(var r=0;r<t.length;++r){var i=t[r];if(!b(i)&&!y(i)){n.push(i)}}return n.join("\n")}function y(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function b(n){var r=/at .+ \((.*):(\d+):\d+\)/.exec(n);if(!r){return false}var i=r[1];var s=r[2];return i===t&&s>=e&&s<=dt}function w(){if(Error.captureStackTrace){var e,n;var r=Error.prepareStackTrace;Error.prepareStackTrace=function(t,r){e=r[1].getFileName();n=r[1].getLineNumber()};(new Error).stack;Error.prepareStackTrace=r;t=e;return n}}function E(e,t,n){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack)}return e.apply(e,arguments)}}function S(e){return F(e)}function x(){function a(i){if(!e){return}n=F(i);o(e,function(e,t){r(function(){n.promiseDispatch.apply(n,t)})},void 0);e=void 0;t=void 0}var e=[],t=[],n;var i=f(x.prototype);var u=f(N.prototype);u.promiseDispatch=function(i,o,u){var a=s(arguments);if(e){e.push(a);if(o==="when"&&u[1]){t.push(u[1])}}else{r(function(){n.promiseDispatch.apply(n,a)})}};u.valueOf=function(){if(e){return u}var t=C(n);if(k(t)){n=t}return t};if(Error.captureStackTrace&&S.longStackJumpLimit>0){Error.captureStackTrace(u,x);u.stack=u.stack.substring(u.stack.indexOf("\n")+1)}i.promise=u;i.resolve=a;i.fulfill=function(e){a(j(e))};i.reject=function(e){a(B(e))};i.notify=function(n){if(e){o(t,function(e,t){r(function(){t(n)})},void 0)}};return i}function T(e){var t=x();G(e,t.resolve,t.reject,t.notify).fail(t.reject);return t.promise}function N(e,t,n,r,i){if(t===void 0){t=function(e){return B(new Error("Promise does not support operation: "+e))}}var s=f(N.prototype);s.promiseDispatch=function(n,r,i){var o;try{if(e[r]){o=e[r].apply(s,i)}else{o=t.call(s,r,i)}}catch(u){o=B(u)}if(n){n(o)}};if(n){s.valueOf=n}if(i){s.exception=r}return s}function C(e){if(k(e)){return e.valueOf()}return e}function k(e){return e&&typeof e.promiseDispatch==="function"}function L(e){return e&&typeof e.then==="function"}function A(e){return!O(e)&&!M(e)}function O(e){return!L(C(e))}function M(e){e=C(e);return k(e)&&"exception"in e}function H(){if(!P&&typeof window!=="undefined"&&!window.Touch&&window.console){console.log("Should be empty:",D)}P=true}function B(e){var t=N({when:function(t){if(t){var n=u(_,this);if(n!==-1){D.splice(n,1);_.splice(n,1)}}return t?t(e):this}},function(){return B(e)},function n(){return this},e,true);H();_.push(t);D.push(e);return t}function j(e){return N({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){if(t==null){return e.apply(void 0,n)}else{return e[t].apply(e,n)}},apply:function(t,n){return e.apply(t,n)},keys:function(){return c(e)}},void 0,function t(){return e})}function F(e){if(k(e)){return e}e=C(e);if(L(e)){return I(e)}else{return j(e)}}function I(e){var t=x();r(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}});return t.promise}function q(e){return N({isDef:function(){}},function(n,r){return V(e,n,r)},function(){return C(e)})}function R(e,t,n,i){function u(e){try{return typeof t==="function"?t(e):e}catch(n){return B(n)}}function a(e){if(typeof n==="function"){m(e,l);try{return n(e)}catch(t){return B(t)}}return B(e)}function f(e){return typeof i==="function"?i(e):e}var s=x();var o=false;var l=F(e);r(function(){l.promiseDispatch(function(e){if(o){return}o=true;s.resolve(u(e))},"when",[function(e){if(o){return}o=true;s.resolve(a(e))}])});l.promiseDispatch(void 0,"when",[void 0,function(e){var t;var n=false;try{t=f(e)}catch(r){n=true;if(S.onerror){S.onerror(r)}else{throw r}}if(!n){s.notify(t)}}]);return s.promise}function U(e,t,n){return R(e,function(e){return Z(e).then(function(e){return t.apply(void 0,e)},n)},n)}function z(e){return function(){function t(e,t){var s;try{s=n[e](t)}catch(o){if(p(o)){return o.value}else{return B(o)}}return R(s,r,i)}var n=e.apply(this,arguments);var r=t.bind(t,"send");var i=t.bind(t,"throw");return r()}}function W(e){throw new d(e)}function X(e){return function(){return U([this,Z(arguments)],function(t,n){return e.apply(t,n)})}}function V(e,t,n){var i=x();r(function(){F(e).promiseDispatch(i.resolve,t,n)});return i.promise}function $(e){return function(t){var n=s(arguments,1);return V(t,e,n)}}function K(e,t){var n=s(arguments,2);return J(e,t,n)}function Q(e,t){return V(e,"apply",[void 0,t])}function G(e){var t=s(arguments,1);return Q(e,t)}function Y(e){var t=s(arguments,1);return function(){var r=t.concat(s(arguments));return V(e,"apply",[this,r])}}function Z(e){return R(e,function(e){var t=0;var n=x();o(e,function(r,i,s){if(O(i)){e[s]=C(i)}else{++t;R(i,function(r){e[s]=r;if(--t===0){n.resolve(e)}},n.reject)}},void 0);if(t===0){n.resolve(e)}return n.promise})}function et(e){return R(e,function(e){e=a(e,F);return R(Z(a(e,function(e){return R(e,n,n)})),function(){return e})})}function tt(e,t){return R(e,void 0,t)}function nt(e,t){return R(e,void 0,void 0,t)}function rt(e,t){return R(e,function(e){return R(t(),function(){return e})},function(e){return R(t(),function(){return B(e)})})}function it(e,t,n,i){var s=function(t){r(function(){m(t,e);if(S.onerror){S.onerror(t)}else{throw t}})};var o=t||n||i?R(e,t,n,i):e;if(typeof process==="object"&&process&&process.domain){s=process.domain.bind(s)}tt(o,s)}function st(e,t){var n=x();var r=setTimeout(function(){n.reject(new Error("Timed out after "+t+" ms"))},t);R(e,function(e){clearTimeout(r);n.resolve(e)},function(e){clearTimeout(r);n.reject(e)});return n.promise}function ot(e,t){if(t===void 0){t=e;e=void 0}var n=x();setTimeout(function(){n.resolve(e)},t);return n.promise}function ut(e,t){var n=s(t);var r=x();n.push(r.makeNodeResolver());Q(e,n).fail(r.reject);return r.promise}function at(e){var t=s(arguments,1);var n=x();t.push(n.makeNodeResolver());Q(e,t).fail(n.reject);return n.promise}function ft(e){var t=s(arguments,1);return function(){var n=t.concat(s(arguments));var r=x();n.push(r.makeNodeResolver());Q(e,n).fail(r.reject);return r.promise}}function lt(e){var t=s(arguments,1);return function(){function o(){return e.apply(i,arguments)}var n=t.concat(s(arguments));var r=x();n.push(r.makeNodeResolver());var i=this;Q(o,n).fail(r.reject);return r.promise}}function ct(e,t,n){var r=s(n||[]);var i=x();r.push(i.makeNodeResolver());J(e,t,r).fail(i.reject);return i.promise}function ht(e,t){var n=s(arguments,2);var r=x();n.push(r.makeNodeResolver());J(e,t,n).fail(r.reject);return r.promise}function pt(e,t){if(t){e.then(function(e){r(function(){t(null,e)})},function(e){r(function(){t(e)})})}else{return e}}var e=w();var t;var n=function(){};var r;if(typeof process!=="undefined"){r=process.nextTick}else if(typeof setImmediate==="function"){if(typeof window!=="undefined"){r=setImmediate.bind(window)}else{r=setImmediate}}else{(function(){function a(){--i;if(++o>=n){o=0;n*=4;var t=s&&Math.min(s-1,n);while(i<t){++i;u()}}while(s){--s;e=e.next;var r=e.task;e.task=void 0;r()}o=0}var e={task:void 0,next:null},t=e,n=2,i=0,s=0,o=0,u;r=function(e){t=t.next={task:e,next:null};if(i<++s&&i<n){++i;u()}};if(typeof MessageChannel!=="undefined"){var f=new MessageChannel;f.port1.onmessage=a;u=function(){f.port2.postMessage(0)}}else{u=function(){setTimeout(a,0)}}})()}var s=i(Array.prototype.slice);var o=i(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1){do{if(n in this){t=this[n++];break}if(++n>=r){throw new TypeError}}while(1)}for(;n<r;n++){if(n in this){t=e(t,this[n],n)}}return t});var u=i(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++){if(this[t]===e){return t}}return-1});var a=i(Array.prototype.map||function(e,t){var n=this;var r=[];o(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0);return r});var f=Object.create||function(e){function t(){}t.prototype=e;return new t};var l=i(Object.prototype.hasOwnProperty);var c=Object.keys||function(e){var t=[];for(var n in e){if(l(e,n)){t.push(n)}}return t};var h=i(Object.prototype.toString);var d;if(typeof ReturnValue!=="undefined"){d=ReturnValue}else{d=function(e){this.value=e}}S.longStackJumpLimit=1;var v="From previous event:";S.nextTick=r;S.defer=x;x.prototype.makeNodeResolver=function(){var e=this;return function(t,n){if(t){e.reject(t)}else if(arguments.length>2){e.resolve(s(arguments,1))}else{e.resolve(n)}}};S.promise=T;S.makePromise=N;N.prototype.then=function(e,t,n){return R(this,e,t,n)};N.prototype.thenResolve=function(e){return R(this,function(){return e})};N.prototype.thenReject=function(e){return R(this,function(){throw e})};o(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","put","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","denodeify","nbind","ncall","napply","nbind","npost","nsend","ninvoke","nodeify"],function(e,t){N.prototype[t]=function(){return S[t].apply(S,[this].concat(s(arguments)))}},void 0);N.prototype.toSource=function(){return this.toString()};N.prototype.toString=function(){return"[object Promise]"};S.nearer=C;S.isPromise=k;S.isPromiseAlike=L;S.isPending=A;S.isFulfilled=O;S.isRejected=M;var _=[];var D=[];var P;if(typeof process!=="undefined"&&process.on){process.on("exit",function(){for(var e=0;e<D.length;e++){var t=D[e];if(t&&typeof t.stack!=="undefined"){console.warn("Unhandled rejected promise:",t.stack)}else{console.warn("Unhandled rejected promise (no stack):",t)}}})}S.reject=B;S.fulfill=j;S.resolve=F;S.master=q;S.when=R;S.spread=U;S.async=z;S["return"]=W;S.promised=X;S.dispatch=V;S.dispatcher=$;S.get=$("get");S.set=$("set");S["delete"]=S.del=$("delete");var J=S.post=$("post");S.send=K;S.invoke=K;S.fapply=Q;S["try"]=G;S.fcall=G;S.fbind=Y;S.keys=$("keys");S.all=Z;S.allResolved=et;S["catch"]=S.fail=tt;S.progress=nt;S["finally"]=S.fin=rt;S.done=it;S.timeout=st;S.delay=ot;S.nfapply=ut;S.nfcall=at;S.nfbind=ft;S.denodeify=S.nfbind;S.nbind=lt;S.npost=ct;S.nsend=ht;S.ninvoke=S.nsend;S.nodeify=pt;var dt=w();return S})